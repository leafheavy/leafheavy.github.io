<link rel="apple-touch-icon" sizes="180x180" href="{{ "/images/apple-touch-icon.png" | relative_url }}">
<link rel="icon" type="image/png" sizes="32x32" href="{{ "/images/favicon-32x32.png" | relative_url }}">
<link rel="icon" type="image/png" sizes="16x16" href="{{ "/images/favicon-16x16.png" | relative_url }}">
<link rel="manifest" href="{{ "/images/site.webmanifest" | relative_url }}">

<meta name="msapplication-TileColor" content="#000000">
<meta name="msapplication-TileImage" content="{{ "/images/mstile-144x144.png?v=M44lzPylqQ" | relative_url }}">
<meta name="msapplication-config" content="{{ "/images/browserconfig.xml?v=M44lzPylqQ" | relative_url }}">
<meta name="theme-color" content="#ffffff">
<link rel="stylesheet" href="{{ "/assets/css/academicons.css" | relative_url }}"/>

<script>
  function applyAppleEquationNumbers() {
    var blocks = document.querySelectorAll('.apple-article-body mjx-container[display="true"]');
    var counter = 0;

    blocks.forEach(function (block) {
      var hasMathJaxTag = block.querySelector('mjx-tag') || block.querySelector('.mjx-tag');
      block.classList.add('apple-equation-block');

      if (hasMathJaxTag) {
        return;
      }

      counter += 1;
      var numberEl = block.querySelector('.apple-equation-number');
      if (!numberEl) {
        numberEl = document.createElement('span');
        numberEl.className = 'apple-equation-number';
        block.appendChild(numberEl);
      }
      numberEl.textContent = '(' + counter + ')';
    });
  }

  function normalizeCodeLanguageClasses() {
    var nodes = document.querySelectorAll('pre[class], code[class], div[class], figure[class]');
    var knownLanguages = ['latex', 'python'];

    nodes.forEach(function (node) {
      var classNames = Array.from(node.classList);
      classNames.forEach(function (className) {
        var lowerClass = className.toLowerCase();
        var languageMatch = className.match(/^language-(.+)$/i);

        if (languageMatch) {
          var normalizedLanguageClass = 'language-' + languageMatch[1].toLowerCase();
          if (normalizedLanguageClass !== className) {
            node.classList.remove(className);
          }
          if (!node.classList.contains(normalizedLanguageClass)) {
            node.classList.add(normalizedLanguageClass);
          }
          return;
        }
        if (knownLanguages.indexOf(lowerClass) !== -1) {
          if (lowerClass !== className) {
            node.classList.remove(className);
          }
          if (!node.classList.contains(lowerClass)) {
            node.classList.add(lowerClass);
          }
          if (!node.classList.contains('language-' + lowerClass)) {
            node.classList.add('language-' + lowerClass);
          }
        }
      });
    });
  }

  function pageHasMathContent() {
    var contentNode = document.querySelector('.page__content, .apple-article-body');
    if (!contentNode) {
      return false;
    }

    var rawText = contentNode.textContent || '';
    var hasDisplayOrLatexMarkers = /\$\$|\\\(|\\\)|\\\[|\\\]|\\begin\{|\\operatorname\{|\\boldsymbol\{|\\mathbb\{/.test(rawText);
    var hasInlineDollarMath = /(^|[^\\])\$[^$\n]+\$(?!\$)/.test(rawText);
    return hasDisplayOrLatexMarkers || hasInlineDollarMath;
  }

  function configureMathJax() {
    var commonTexPackages = [
      'ams',
      'newcommand',
      'configmacros',
      'textmacros',
      'mathtools',
      'physics',
      'cancel',
      'color',
      'braket',
      'html',
      'amsthm'  /* 修改 1: 添加 amsthm 包，提供标准的定理证明环境支持 */
    ];

    var defaultMacros = {
      determinant: ['\\lvert #1 \\rvert', 1],
      item: '\\\\ \\text{• }'
    };
    var pageMacros = {{ page.mathjax_macros | jsonify }} || {};

    window.MathJax = {
      loader: {
        load: commonTexPackages.map(function (pkg) {
          return '[tex]/' + pkg;
        })
      },
      tex: {
        packages: {
          '[+]': commonTexPackages
        },
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$', '$$'], ['\\[', '\\]']],
        macros: Object.assign({}, defaultMacros, pageMacros),
        environments: {
          /* 修改 2: 移除了 proof 的手动定义，交给 amsthm 或 HTML 自身处理 */
          /* proof: ['\\textbf{Proof. }', '\\quad\\square'], */ 
          itemize: ['\\begin{array}{l}', '\\end{array}']
        },
        processEscapes: true,
        processEnvironments: true,
        tags: 'all'
      },
      chtml: {
        linebreaks: {
          automatic: true,
          width: 'container'
        }
      },
      options: {
        skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      },
      startup: {
        pageReady: function () {
          return MathJax.startup.defaultPageReady().then(function () {
            applyAppleEquationNumbers();
          });
        }
      }
    };
  }

  function loadMathJaxIfNeeded() {
    var frontMatterEnabled = {{ page.mathjax | default: false | jsonify }};
    if (!frontMatterEnabled && !pageHasMathContent()) {
      return;
    }
  if (!window.MathJax) {
      configureMathJax();
    }

    if (!document.querySelector('link[data-mathjax-preconnect]')) {
      var preconnect = document.createElement('link');
      preconnect.rel = 'preconnect';
      preconnect.href = 'https://cdn.jsdelivr.net';
      preconnect.crossOrigin = 'anonymous';
      preconnect.setAttribute('data-mathjax-preconnect', 'true');
      document.head.appendChild(preconnect);
    }

    if (!document.querySelector('script[data-mathjax-script]')) {
      var script = document.createElement('script');
      script.defer = true;
      script.src = 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js';
      script.setAttribute('data-mathjax-script', 'true');
      document.head.appendChild(script);
      return;
    }

    if (window.MathJax && MathJax.typesetPromise) {
      MathJax.typesetPromise().then(function () {
        applyAppleEquationNumbers();
      });
    }
  }

  document.addEventListener('DOMContentLoaded', function () {
    normalizeCodeLanguageClasses();
    loadMathJaxIfNeeded();
  });
</script>

<!-- end custom head snippets -->