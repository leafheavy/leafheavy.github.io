<link rel="apple-touch-icon" sizes="180x180" href="{{ "/images/apple-touch-icon.png" | relative_url }}">
<link rel="icon" type="image/png" sizes="32x32" href="{{ "/images/favicon-32x32.png" | relative_url }}">
<link rel="icon" type="image/png" sizes="16x16" href="{{ "/images/favicon-16x16.png" | relative_url }}">
<link rel="manifest" href="{{ "/images/site.webmanifest" | relative_url }}">

<meta name="msapplication-TileColor" content="#000000">
<meta name="msapplication-TileImage" content="{{ "/images/mstile-144x144.png?v=M44lzPylqQ" | relative_url }}">
<meta name="msapplication-config" content="{{ "/images/browserconfig.xml?v=M44lzPylqQ" | relative_url }}">
<meta name="theme-color" content="#ffffff">
<link rel="stylesheet" href="{{ "/assets/css/academicons.css" | relative_url }}"/>

<script>
  function applyAppleEquationNumbers() {
    var blocks = document.querySelectorAll('.apple-article-body mjx-container[display="true"]');
    var counter = 0;

    blocks.forEach(function (block) {
      var hasMathJaxTag = block.querySelector('mjx-tag') || block.querySelector('.mjx-tag');
      block.classList.add('apple-equation-block');

      if (hasMathJaxTag) {
        return;
      }

      counter += 1;
      var numberEl = block.querySelector('.apple-equation-number');
      if (!numberEl) {
        numberEl = document.createElement('span');
        numberEl.className = 'apple-equation-number';
        block.appendChild(numberEl);
      }
      numberEl.textContent = '(' + counter + ')';
    });
  }

  function normalizeCodeLanguageClasses() {
    var nodes = document.querySelectorAll('pre[class], code[class], div[class], figure[class]');
    var knownLanguages = ['latex', 'python'];

    nodes.forEach(function (node) {
      var classNames = Array.from(node.classList);
      classNames.forEach(function (className) {
        var lowerClass = className.toLowerCase();
        var languageMatch = className.match(/^language-(.+)$/i);

        if (languageMatch) {
          var normalizedLanguageClass = 'language-' + languageMatch[1].toLowerCase();
          if (normalizedLanguageClass !== className) {
            node.classList.remove(className);
          }
          if (!node.classList.contains(normalizedLanguageClass)) {
            node.classList.add(normalizedLanguageClass);
          }
          return;
        }
        if (knownLanguages.indexOf(lowerClass) !== -1) {
          if (lowerClass !== className) {
            node.classList.remove(className);
          }
          if (!node.classList.contains(lowerClass)) {
            node.classList.add(lowerClass);
          }
          if (!node.classList.contains('language-' + lowerClass)) {
            node.classList.add('language-' + lowerClass);
          }
        }
      });
    });
  }

  {% if page.mathjax %}
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      displayMath: [['$$', '$$'], ['\\[', '\\]']],
      processEscapes: true,
      processEnvironments: true,
      tags: 'all'
    },
    options: {
      skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    startup: {
      pageReady: function () {
        return MathJax.startup.defaultPageReady().then(function () {
          applyAppleEquationNumbers();
        });
      }
    }
  };
  {% endif %}

  document.addEventListener('DOMContentLoaded', function () {
    normalizeCodeLanguageClasses();

    if (window.MathJax && MathJax.typesetPromise) {
      MathJax.typesetPromise().then(function () {
        applyAppleEquationNumbers();
      });
    }
  });
</script>
{% if page.mathjax %}
<link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
<script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
{% endif %}

<!-- end custom head snippets -->
